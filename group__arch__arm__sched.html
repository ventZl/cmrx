<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C Microkernel Realtime eXecutive: Scheduler implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="all">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">C Microkernel Realtime eXecutive
   </div>
   <div id="projectbrief">Realtime Operating System for Cortex-M based microcontrollers</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__arch__arm__sched.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Scheduler implementation<div class="ingroups"><a class="el" href="group__os.html">Kernel documentation</a> &raquo; <a class="el" href="group__arch.html">Architecture support</a> &raquo; <a class="el" href="group__arch__arm.html">ARM port</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Kernel scheduler internals.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga10b2d890d871e1489bb02b7e70d9bdfb" id="r_ga10b2d890d871e1489bb02b7e70d9bdfb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a>&#160;&#160;&#160;static</td></tr>
<tr class="separator:ga10b2d890d871e1489bb02b7e70d9bdfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga22edc1a4b8311885fceefba6b73f77af" id="r_ga22edc1a4b8311885fceefba6b73f77af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga22edc1a4b8311885fceefba6b73f77af">os_thread_initialize_arch</a> (struct <a class="el" href="structOS__thread__t.html">OS_thread_t</a> *thread, unsigned stack_size, entrypoint_t *entrypoint, void *data)</td></tr>
<tr class="memdesc:ga22edc1a4b8311885fceefba6b73f77af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform architecture-specific thread initialization This function should perform the following actions:  <br /></td></tr>
<tr class="separator:ga22edc1a4b8311885fceefba6b73f77af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga770860e52c205dc2a7e865b80b0fca11" id="r_ga770860e52c205dc2a7e865b80b0fca11"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga770860e52c205dc2a7e865b80b0fca11">os_process_create</a> (<a class="el" href="group__api.html#ga36958e2082eecb09f367fa4aa3a9a84d">Process_t</a> process_id, const struct <a class="el" href="structOS__process__definition__t.html">OS_process_definition_t</a> *definition)</td></tr>
<tr class="memdesc:ga770860e52c205dc2a7e865b80b0fca11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create process using process definition.  <br /></td></tr>
<tr class="separator:ga770860e52c205dc2a7e865b80b0fca11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1efbfe606317fd469d8fc187a4cb9a79" id="r_ga1efbfe606317fd469d8fc187a4cb9a79"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga1efbfe606317fd469d8fc187a4cb9a79">os_boot_thread</a> (<a class="el" href="group__api.html#gaae12e635a9412afabedb95620d3e2ffe">Thread_t</a> boot_thread)</td></tr>
<tr class="memdesc:ga1efbfe606317fd469d8fc187a4cb9a79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start executing thread.  <br /></td></tr>
<tr class="separator:ga1efbfe606317fd469d8fc187a4cb9a79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0ef00a0f1fe50bb0af3bbf05cbdddfe3" id="r_ga0ef00a0f1fe50bb0af3bbf05cbdddfe3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga0ef00a0f1fe50bb0af3bbf05cbdddfe3">os_reset_cpu</a> ()</td></tr>
<tr class="memdesc:ga0ef00a0f1fe50bb0af3bbf05cbdddfe3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the CPU.  <br /></td></tr>
<tr class="separator:ga0ef00a0f1fe50bb0af3bbf05cbdddfe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa1fe4414a243f61c85e0a1d2fbd01440" id="r_gaa1fe4414a243f61c85e0a1d2fbd01440"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#gaa1fe4414a243f61c85e0a1d2fbd01440">cmrx_shutdown_handler</a> (void)</td></tr>
<tr class="memdesc:gaa1fe4414a243f61c85e0a1d2fbd01440"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default CMRX shutdown handler for ARM CPUs This is default action after for when the CMRX kernel is shutdown.  <br /></td></tr>
<tr class="separator:gaa1fe4414a243f61c85e0a1d2fbd01440"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6e29c6b6f3e6e761c076a0b28490da0e" id="r_ga6e29c6b6f3e6e761c076a0b28490da0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#ga6e29c6b6f3e6e761c076a0b28490da0e">os_kernel_shutdown</a> ()</td></tr>
<tr class="memdesc:ga6e29c6b6f3e6e761c076a0b28490da0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform the kernel shutdown.  <br /></td></tr>
<tr class="separator:ga6e29c6b6f3e6e761c076a0b28490da0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabb3070fe93f5997763b5685b81288f5c" id="r_gabb3070fe93f5997763b5685b81288f5c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arch__arm__sched.html#gabb3070fe93f5997763b5685b81288f5c">os_set_syscall_return_value</a> (<a class="el" href="group__api.html#gaae12e635a9412afabedb95620d3e2ffe">Thread_t</a> thread_id, int32_t retval)</td></tr>
<tr class="memdesc:gabb3070fe93f5997763b5685b81288f5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set return value of syscall for given thread.  <br /></td></tr>
<tr class="separator:gabb3070fe93f5997763b5685b81288f5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Kernel scheduler internals. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga10b2d890d871e1489bb02b7e70d9bdfb" name="ga10b2d890d871e1489bb02b7e70d9bdfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga10b2d890d871e1489bb02b7e70d9bdfb">&#9670;&#160;</a></span>STATIC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATIC&#160;&#160;&#160;static</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaa1fe4414a243f61c85e0a1d2fbd01440" name="gaa1fe4414a243f61c85e0a1d2fbd01440"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa1fe4414a243f61c85e0a1d2fbd01440">&#9670;&#160;</a></span>cmrx_shutdown_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cmrx_shutdown_handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default CMRX shutdown handler for ARM CPUs This is default action after for when the CMRX kernel is shutdown. </p>
<p>It will reset the CPU. If you want to perform different action, then provide your function called `cmrx_shutdown_handler. It will override this one. </p><dl class="section note"><dt>Note</dt><dd>Your function should not return nor try to restart CMRX kernel. If you want to restart the kernel, then perform CPU reset first. </dd></dl>

</div>
</div>
<a id="ga1efbfe606317fd469d8fc187a4cb9a79" name="ga1efbfe606317fd469d8fc187a4cb9a79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1efbfe606317fd469d8fc187a4cb9a79">&#9670;&#160;</a></span>os_boot_thread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_boot_thread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__api.html#gaae12e635a9412afabedb95620d3e2ffe">Thread_t</a>&#160;</td>
          <td class="paramname"><em>boot_thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start executing thread. </p>
<p>Used to actually start executing in thread mode just after the kernel has been initialized and is ready to start the first thread. This function has to perform CPU switch from privileged mode in which kernel runs into unprivileged mode in which threads are supposed to run. Thread passed to this function is in state ready to be executed by normal kernel thread switching mechanism on this platform. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">boot_thread</td><td>ID of thread that shall be started </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga6e29c6b6f3e6e761c076a0b28490da0e" name="ga6e29c6b6f3e6e761c076a0b28490da0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6e29c6b6f3e6e761c076a0b28490da0e">&#9670;&#160;</a></span>os_kernel_shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_kernel_shutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform the kernel shutdown. </p>
<p>Stop running the kernel.</p>
<p>This is platform-specific way of how to shutdown the kernel. In this case an interrupt frame is forged on stack that will resemble a frame returning back to the <a class="el" href="group__arch__arm__sched.html#gaa1fe4414a243f61c85e0a1d2fbd01440">cmrx_shutdown_handler</a> function. The result of running this function will be that the processor leaves the handler mode, enters privileged thread mode and will be using MSP. </p>

</div>
</div>
<a id="ga770860e52c205dc2a7e865b80b0fca11" name="ga770860e52c205dc2a7e865b80b0fca11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga770860e52c205dc2a7e865b80b0fca11">&#9670;&#160;</a></span>os_process_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_process_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__api.html#ga36958e2082eecb09f367fa4aa3a9a84d">Process_t</a>&#160;</td>
          <td class="paramname"><em>process_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structOS__process__definition__t.html">OS_process_definition_t</a> *&#160;</td>
          <td class="paramname"><em>definition</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create process using process definition. </p>
<p>Takes process definition and initializes MPU regions for process out of it. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">process_id</td><td>ID of process to be initialized </td></tr>
    <tr><td class="paramname">definition</td><td>process definition. This is constructed at compile time using OS_APPLICATION macros </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>E_OK if process was contructed properly, E_INVALID if process ID is already used or if process definition contains invalid section boundaries. E_OUT_OF_RANGE is returned if process ID requested is out of limits given by the size of process table. </dd></dl>

</div>
</div>
<a id="ga0ef00a0f1fe50bb0af3bbf05cbdddfe3" name="ga0ef00a0f1fe50bb0af3bbf05cbdddfe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0ef00a0f1fe50bb0af3bbf05cbdddfe3">&#9670;&#160;</a></span>os_reset_cpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_reset_cpu </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the CPU. </p>
<p>This is architecture- (and possibly HAL-) specific way to reset the CPU. This function can be used before the kernel has been started or after it has been shut down. If there is no shutdown handler provided by the integrator then the default handler will call this function to reset the CPU automatically. </p>

</div>
</div>
<a id="gabb3070fe93f5997763b5685b81288f5c" name="gabb3070fe93f5997763b5685b81288f5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabb3070fe93f5997763b5685b81288f5c">&#9670;&#160;</a></span>os_set_syscall_return_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int os_set_syscall_return_value </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__api.html#gaae12e635a9412afabedb95620d3e2ffe">Thread_t</a>&#160;</td>
          <td class="paramname"><em>thread_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>retval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set return value of syscall for given thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread_id</td><td>Id of the thread whose exception handler is being modified </td></tr>
    <tr><td class="paramname">retval</td><td>value to store on the stack </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga22edc1a4b8311885fceefba6b73f77af" name="ga22edc1a4b8311885fceefba6b73f77af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga22edc1a4b8311885fceefba6b73f77af">&#9670;&#160;</a></span>os_thread_initialize_arch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void os_thread_initialize_arch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structOS__thread__t.html">OS_thread_t</a> *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>stack_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">entrypoint_t *&#160;</td>
          <td class="paramname"><em>entrypoint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform architecture-specific thread initialization This function should perform the following actions: </p>
<ul>
<li>Configure thread state so it can be executed immediately after this function is done</li>
<li>Set valid value into SP member, so the stack pointer can be set to valid value</li>
<li>Perform any architecture-specific steps needed to make thread executable</li>
<li>Set any architecture-specific settings <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>pointer to structure describing the thread just being created </td></tr>
    <tr><td class="paramname">stack_size</td><td>size of stack in 32-bit quantities </td></tr>
    <tr><td class="paramname">entrypoint</td><td>address of thread entrypoint function </td></tr>
    <tr><td class="paramname">data</td><td>address of data passed to the thread as its 1st argument </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Address to which the SP shall be set. </dd></dl>
</li>
</ul>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</div>
</body>
</html>
