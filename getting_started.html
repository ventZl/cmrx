<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C Microkernel Realtime eXecutive: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="all">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">C Microkernel Realtime eXecutive
   </div>
   <div id="projectbrief">Realtime Operating System for Cortex-M based microcontrollers</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('getting_started.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting started</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here a step-by-step getting started guide is provided to start development using CMRX as the RTOS. It covers all steps needed to start new project using CMRX. In this guide, we will assume that the reader has prior experience with developing basic bare metal applications in the embedded environment and is aware of basic terms such as toolchain, linker scripts, HAL and binaries.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Obtain dependencies and CMRX</h1>
<p>As CMRX is based on CMake and is using Python internally, you need to get both recent CMake and Python. The last tool, which is actually not a dependency, but will make your life easier is Git. Now, you can establish your project by creating an empty directory and initializing it as git repository, then you can add CMRX as a sub-module in that repository:</p>
<div class="fragment"><div class="line">mkdir project-dir</div>
<div class="line">cd project-dir</div>
<div class="line">git init</div>
<div class="line">git submodule add https://github.com/ventZl/cmrx.git</div>
<div class="line">git submodule update --init</div>
</div><!-- fragment --><p>This will create directory <code>cmrx</code> inside your project and retrieve current copy of CMRX in there. This directory contains the source code, headers, CMake modules and all the necessary auxiliary tools needed for CMRX to build.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Project template</h1>
<p>Next, you can use following block as a template of your CMakeLists.txt</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.12)</div>
<div class="line"> </div>
<div class="line">list(APPEND CMAKE_MODULE_PATH &quot;${CMAKE_SOURCE_DIR}/cmrx/cmake&quot;)</div>
<div class="line"> </div>
<div class="line">project(cmrx-example LANGUAGES C ASM)</div>
<div class="line"> </div>
<div class="line"># Tell CMRX what architecture and HAL is used</div>
<div class="line">set(CMRX_ARCH arm)</div>
<div class="line">set(CMRX_HAL cmsis)</div>
<div class="line">include(CMRX)</div>
<div class="line"> </div>
<div class="line">add_subdirectory(cmrx)</div>
<div class="line"> </div>
<div class="line"># Define the main firmware entry with startup file</div>
<div class="line">set(helloworld_SRCS main.c)</div>
<div class="line">add_firmware(helloworld ${helloworld_SRCS})</div>
<div class="line"> </div>
<div class="line"># Define one userspace application executed by CMRX</div>
<div class="line">set(hello_app_SRCS hello.c)</div>
<div class="line">add_application(hello ${hello_app_SRCS})</div>
<div class="line"> </div>
<div class="line">target_link_libraries(helloworld cmrx)</div>
<div class="line">target_add_applications(helloworld init)</div>
</div><!-- fragment --><p>Above example makes a choice of the ARM target architecture and CMSIS-based HAL. More on how to integrate with HALs below. It also mentions two source files: <code>main.c</code> and <code>hello.c</code>. Lets create both of them:</p>
<p>main.c: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cmrx/cmrx.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="group__os.html#ga66e1653fdfc09dfb93da917d0f833888">os_start</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__os_html_ga66e1653fdfc09dfb93da917d0f833888"><div class="ttname"><a href="group__os.html#ga66e1653fdfc09dfb93da917d0f833888">os_start</a></div><div class="ttdeci">void os_start()</div><div class="ttdoc">Start up scheduler.</div><div class="ttdef"><b>Definition</b> sched.c:443</div></div>
</div><!-- fragment --><p>hello.c </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cmrx/application.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> main(<span class="keywordtype">void</span> * unused)</div>
<div class="line">{</div>
<div class="line">    (void) unused;</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">CMRX_APPLICATION(init);</div>
<div class="line">CMRX_APPLICATION_MMIO_RANGE(init);</div>
<div class="line">CMRX_THREAD_CREATE(init, main, <a class="code hl_define" href="group__api.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 64);</div>
<div class="ttc" id="agroup__api_html_ga070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="group__api.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdoc">Name the null pointer.</div><div class="ttdef"><b>Definition</b> defines.h:42</div></div>
</div><!-- fragment --><p>This constructs the minimal example. It is not buildable yet, because we have to integrate startup files provided by the HAL somehow. CMRX using CMSIS expects that RTE_components.h file is available in include path. This file shall be provided by the runtime, but usually is not. There is a helper CMake module, which can try to find CMSIS components, set up include paths, create RTE_Components.h file and create targets to build startup and system components of HAL (if present).</p>
<p>To use this helper, you have to add lines similar to these before you include CMRX CMake module:</p>
<div class="fragment"><div class="line">set(CMSIS_ROOT &lt;path to CMSIS root directory&gt;)</div>
<div class="line">set(DEVICE &lt;MCU name recognized by your CMSIS&gt;)</div>
<div class="line">set(CMSIS_LINKER_FILE &lt;path to the linker file provided by the CMSIS&gt;)</div>
<div class="line">include(FindCMSIS)</div>
</div><!-- fragment --><p>Actual usability of this helper depends on how much your HAL complies with CMSIS specification. Some HALs are known to not supply linker scripts or to deviate in certain details.</p>
<p>Then the project can be compiled using following commands: </p><pre class="fragment">cmake -B build
cmake --build build
</pre><p> This shall create a binary named <code>build/helloworld.elf</code>. You can load this file into your microcontroller and run it. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</div>
</body>
</html>
