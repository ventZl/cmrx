<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C Microkernel Realtime eXecutive: Development Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="all">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">C Microkernel Realtime eXecutive
   </div>
   <div id="projectbrief">Realtime Operating System for Cortex-M based microcontrollers</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dev_env.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Development Environment</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CMRX is using CMake build system. There are several entities which are visible from the project which integrates CMRX in their buildsystem:</p>
<ul>
<li>CMRX CMake module - this module defines several functions that wrap creation of libraries and executables with post build events and calculate certain properties.</li>
<li>CMRX source and header directories - here, the code and headers of CMRX are stored. CMRX is distributed as a source and is compiled during the build of the firmware. Build of CMRX results in creation of library named <code>os</code> which you have to link to the final executable. Include paths to headers are automatically propagated to each target which links to the <code>os</code> library.</li>
<li>Linker script adjustment tool - for seamless operation of memory protection, it is necessary to calculate alignment values for private data of each process. This mechanism takes the original linker script and injects per-process include blocks into it. These blocks are then adjusted based on map file analysis. This altered linker script is then used to link the binary.</li>
</ul>
<h2><a class="anchor" id="autotoc_md34"></a>
CMake functions</h2>
<p>While firmware built using CMRX is pretty much standard binary, there are certain tasks done after the binary is built. Similarly, every CMRX process is wrapped into fairly standard static library, yet there are some tasks done after the library is built. In order for things to work correctly, CMRX is also maintaining a set of properties bound to either firmware images or process libraries. There are three main CMake functions available for use:</p>
<div class="fragment"><div class="line">add_firmware(&lt;firmware name&gt; &lt;source file(s)&gt;)</div>
</div><!-- fragment --><p>Use this function in place of <code>add_executable()</code> to define firmware binary. Adding binary this way will automatically enable map file creation, apply patched linker script and add post-build actions which automatically recompute alignment constants. It also generates properties needed to ensure reliable operation.</p>
<div class="fragment"><div class="line">add_application(&lt;application name&gt; &lt;source file(s)&gt;)</div>
</div><!-- fragment --><p>Use this function in place of <code>add_library()</code> to create a static library which contains all the process data and code. Creating process this way will automatically add some post build events which perform sanity checks and create linker script includes.</p>
<div class="fragment"><div class="line">target_add_applications(&lt;firmware name&gt; &lt;application name(s)&gt;)</div>
</div><!-- fragment --><p>Use this function to link application libraries to the firmware binary. This command effectively wraps <code>target_link_libraries()</code> command, while doing some sanity checks and generating post-build events to ensure that the linker script is always up to date.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Source and header directories</h2>
<p>CMRX is distributed as a source and it has to be compiled with your application in order to build runnable firmware. To accomplish this you have to use <code>add_subdirectory()</code> command to add CMRX sources into your project. By doing so, several new targets will be defined:</p>
<ul>
<li>library <code>os</code> - this library wraps all the compiled code of the CMRX kernel. It is internally composed of two parts: the portable part and the architecture port. The architecture port is handled automatically. Library propagates include paths into every target you link against it. Therefore you don't have to set up include paths to be able to include CMRX headers explicitly.</li>
<li>library <code>stdlib</code> - this library contains functions that call system calls. These functions are callable from processes. See <a class="el" href="group__api.html">Kernel API</a> to learn on what functions are available.</li>
<li>library <code>aux_systick</code> - this is an auxiliary library which implements SysTick-based timing provider. This optional library can be used to quickly bootstrap the kernel before more comprehensive hardware- and task-specific timing provider is developed.</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Linker script adjustment tool</h2>
<p>This tool makes the use of memory protection seamless. The main purpose of this tool is to recalculate alignment of data regions of each process based on its size. This is necessary, because memory protection units on most microcontrollers have a limitation, that a region which has access rights defined by MPU must have it's base address aligned at least to its size. So if the region is 256 bytes large, it has to start at address aligned to 256 bytes. Due to this, the size of data segments has to be determined after build and then new alignments have to be determined. To save the RAM, regions are ordered descending based on their alignment.</p>
<p>One side effect of this mechanism is, that sometimes, the binary has to be linked twice. This happens when the size of data block causes that the alignment value used to link it is not valid anymore. In such case, you have to link the binary again using new, up to date linker script. If linker script adjustment tool detects this case, it will delete the firmware binary. This behavior is to prevent use of incorrectly linked binary which won't run. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</div>
</body>
</html>
